<!DOCTYPE html>
<html ng-app="seagrass">
    <head>
        <meta charset="utf-8" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">

        <link rel="stylesheet" href="lib/onsen/css/onsenui.css">
        <link rel="stylesheet" href="lib/onsen/css/onsen-css-components.css">
        <link rel="stylesheet" href="css/app.css">
        <title>SeaGrass</title>

        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="lib/onsen/js/angular/angular.js"></script>
        <script type="text/javascript" src="lib/onsen/js/onsenui.js"></script>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/app.js"></script>
    </head>
    <body>
        <ons-tabbar>
            <ons-tabbar-item page="metrics.html" label="Metrics" icon="tags" active="true"></ons-tabbar-item>
            <ons-tabbar-item page="control.html" label="Control" icon="gear"></ons-tabbar-item>
        </ons-tabbar>

        <script type="text/ons-template" id="metrics.html">
            <ons-navigator title="Navigator" var="membersNavigator">
            <ons-page style="background-color: #f9f9f9" ng-controller="MetricsController as metrics">
                <div class="button-bar width-full margined" style="width: 300px; margin: 0 auto; background-color: white">
                    <div class="button-bar__item" ng-class="{ active: metrics.isSelected(1)}">
                        <button class="button-bar__button" ng-click="metrics.chooseTab(1)">Members</button>
                    </div>
                    <div class="button-bar__item" ng-class="{ active: metrics.isSelected(2)}">
                        <button class="button-bar__button" ng-click="metrics.chooseTab(2)">Sensors</button>
                    </div>
                    <div class="button-bar__item" ng-class="{ active: metrics.isSelected(3)}">
                        <button class="button-bar__button" ng-click="metrics.chooseTab(3)">Main computer</button>
                    </div>
                </div>

                <div class="panel margined" ng-show="metrics.isSelected(1)">
                    <div ng-controller="MembersController">
                        <ons-row class="margined" style="font-size:14px;">
                            <ons-col class="left">
                            </ons-col>
                            <ons-col class="right" align="center">
                                Updated at {{lastUpdated}}
                            </ons-col>
                            <ons-col class="right" width="20%" style="horizontal-margin:8px">
                                <button ng-click="refresh()"><ons-icon icon="refresh" size="14px" spin="false"></ons-icon></button>
                            </ons-col>
                        </ons-row>

                        <ons-list ng-show="(members | filter:batteryFilter).length > 0" class="vertically-margined">
                            <ons-list-item modifier="chevron" ng-click="membersNavigator.pushPage('outOfBattery.html', { animation : 'slide' } )">
                                <ons-row>
                                    <ons-col class="left">Out of battery : {{(members.members | filter:members.batteryFilter).length}}</ons-col>
                                </ons-row>
                            </ons-list-item>
                        </ons-list>

                        <div style="font-size: 12px" ng-show="members.length > 0">
                           <strong class="margined"><ons-row><ons-col></ons-col><ons-col>Pattern</ons-col><ons-col>Battery</ons-col><ons-col>Lat</ons-col><ons-col>Lon</ons-col></ons-row></strong>
                            <div ng-repeat="member in members">
                                <ons-row>
                                    <ons-col><strong>{{member.name}}</strong></ons-col>
                                    <ons-col><div style="text-align: center">{{member.pattern}}</div></ons-col>
                                    <ons-col>{{member.battery | number : 1}}</ons-col>
                                    <ons-col>{{member.lat}}</ons-col>
                                    <ons-col>{{member.lon}}</ons-col>
                                </ons-row>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel margined" ng-show="metrics.isSelected(2)">
                    <div ng-controller="SensorsController as sensors">
                        <div style="font-size: 12px" ng-show="sensors.sensors.length > 0">
                            <strong class="margined"><ons-row><ons-col></ons-col>
                                <ons-col>Threshold</ons-col>
                                <ons-col>Filter length</ons-col>
                            </ons-row></strong>
                            <div ng-repeat="sensor in sensors.sensors">
                                <ons-row>
                                    <ons-col><strong>{{sensor.name}}</strong></ons-col>
                                    <ons-col><div style="text-align: center">{{sensor.threshold}}</div></ons-col>
                                    <ons-col>{{sensor.filterLength}}</ons-col>
                                </ons-row>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel margined" ng-show="metrics.isSelected(3)">
                    <div ng-controller="ComputerController as computer">
                        <div style="font-size: 12px" ng-show="computer.entries.length > 0">
                            <strong class="margined"><ons-row><ons-col></ons-col>
                                <ons-col>CPU</ons-col>
                                <ons-col>Battery</ons-col>
                                <ons-col>Memory</ons-col>
                            </ons-row></strong>
                            <div ng-repeat="entry in computer.entries">
                                <ons-row>
                                    <ons-col><strong>{{entry.time}}</strong></ons-col>
                                    <ons-col><div style="text-align: center">{{entry.cpu}}</div></ons-col>
                                    <ons-col>{{entry.battery}}</ons-col>
                                    <ons-col>{{entry.memory}}</ons-col>
                                </ons-row>
                            </div>
                        </div>
                    </div>
                </div>
            </ons-page>
            </ons-navigator>
        </script>

        <script type="text/ons-template" id="control.html">
            <ons-navigator title="Navigator" var="controlNavigator">
                    <ons-list ng-controller="ControlController">
                        <ons-list-item>
                            <div class="margined">
                                <button class="button" ng-click="startup()">Statup</button>
                                <button class="button" ng-click="restart()">Restart</button>
                                <button class="button" ng-click="shutdown()">Shutdown</button>
                            </div>
                        </ons-list-item>
                        <ons-list-item modifier="chevron" ng-click="controlNavigator.pushPage('pat.html', { animation : 'slide' } )">
                            <ons-row class="margined">
                                <ons-col class="left">
                                    Configure pattern
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                        <ons-list-item modifier="chevron" ng-show="sensors.length > 0" style="content: '\f105'">
                            <ons-row class="margined">
                                <ons-col class="left">
                                    Configure sensor <select ng-model="chosen_sensor" ng-options="sensor as sensor for sensor in sensors"></select>
                                </ons-col>
                                <ons-col class="right" ng-click="chooseSensor(controlNavigator, 'sensor.html')">
                                </ons-col>
                            </ons-row>
                        </ons-list-item>
                    </ons-list>
            </ons-navigator>
        </script>

        <script type="text/ons-template" id="pat.html">
            <ons-toolbar>
                <div class="left"><ons-back-button>Back</ons-back-button></div>
                <div class="center">Configure Pattern</div>
            </ons-toolbar>
            <div ng-controller="PatternController" class="margined">
                <div class="margined">
                Pattern: <select ng-model="chosen_pattern" ng-options="pattern as pattern for pattern in patterns"></select>
                </div>
                <ons-list>
                    <ons-list-item>
                        Speed: <input ng-model="speed" min="{{speedMin}}" max="{{speedMax}}" type="range" class="range">
                    </ons-list-item>
                    <ons-list-item>
                        Intensity: <input ng-model="intensity" min="{{intensityMin}}" max="{{intensityMax}}" type="range" class="range">
                    </ons-list-item>
                    <ons-list-item>
                        Red: <input ng-model="red" min="0" max="255" type="range" class="range long-range">
                    </ons-list-item>
                    <ons-list-item>
                        Green: <input ng-model="green" min="0" max="255" type="range" class="range long-range">
                    </ons-list-item>
                    <div class="margined">
                        Blue: <input ng-model="blue" min="0" max="255" type="range" class="range long-range">
                    </div>
                </ons-list>
                <button class="button" ng-click="submit()">Submit</button>
            </div>
        </script>

        <script type="text/ons-template" id="sensor.html">
            <div ng-controller="ChosenSensorController">
            <ons-toolbar>
                <div class="left"><ons-back-button>Back</ons-back-button></div>
                <div class="center">"{{chosen_sensor}}"</div>
            </ons-toolbar>
            <div class="margined">
                <div class="margined" ng-show="filterLength > 0">
                    Filter Length: <input ng-model="filterLength" min="1" max="2000" type="range" class="range long-range">
                </div>
                <ons-list ng-show="threshold > 0">
                    <ons-list-item>
                        Threshold: <input ng-model="threshold" min="1" max="2000" type="range" class="range long-range">
                    </ons-list-item>
                </ons-list>
                <button class="button margined" ng-click="submit()">Submit</button>
            </div>
            </div>
        </script>

        <script type="text/ons-template" id="outOfBattery.html">
            <ons-toolbar>
                <div class="left"><ons-back-button>Back</ons-back-button></div>
                <div class="center">Out of battery</div>
            </ons-toolbar>
            <div ng-controller="OutOfBatteryController">
            <div class="margined" style="font-size: 12px" ng-show="outOfBattery.length > 0">
                <strong class="margined"><ons-row><ons-col></ons-col><ons-col>Pattern</ons-col><ons-col>Battery</ons-col><ons-col>Lat</ons-col><ons-col>Lon</ons-col></ons-row></strong>
                <div ng-repeat="member in outOfBattery | orderBy:battery:reverse">
                    <ons-row>
                        <ons-col><strong>{{member.name}}</strong></ons-col>
                        <ons-col><div style="text-align: center">{{member.pattern}}</div></ons-col>
                        <ons-col>{{member.battery | number : 1}}</ons-col>
                        <ons-col>{{member.lat}}</ons-col>
                        <ons-col>{{member.lon}}</ons-col>
                    </ons-row>
                </div>
            </div>
            </div>
        </script>
   </body>
</html>
